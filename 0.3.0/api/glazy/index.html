<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>glazy API documentation</title>
<meta name="description" content="Used to lazily created shared singleton-like objects in a decoupled way …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>glazy</code></h1>
</header>
<section id="section-intro">
<p>Used to lazily created shared singleton-like objects in a decoupled way.</p>
<h1 id="how-to-use">How To Use</h1>
<h1 id="xyngular-python-resource-library">Xyngular Python Resource Library</h1>
<p>Provides way to lazy-load sharable singleton-like resources classes,
while promoting code-decoupling.</p>
<ul>
<li><a href="#xyngular-python-resource-library">Xyngular Python Resource Library</a><ul>
<li><a href="#install-in-python-project">Install in Python project</a><ul>
<li><a href="#poetry">Poetry</a>
* <a href="#gemfury">Gemfury</a></li>
</ul>
</li>
<li><a href="#development">Development</a></li>
<li><a href="#how-to-use">How To Use</a><ul>
<li>Go Here For Another TOC with more topics related to how to use this library in codebase.</li>
<li><a href="#what-its-used-for">What It's Used For</a><ul>
<li><a href="#example-use-cases">Example Use Cases</a></li>
</ul>
</li>
<li><a href="#overview">Overview</a></li>
<li><a href="#quick-start-example-code">Quick Start Example Code</a></li>
</ul>
</li>
<li><a href="#advanced-use-cases">Advanced Use Cases</a><ul>
<li><a href="#resource--dataclasses">Resource + Dataclasses</a></li>
<li><a href="#thread-safety">Thread Safety</a></li>
<li><a href="#active-resource-proxy">Active Resource Proxy</a></li>
</ul>
</li>
<li><a href="#unit-testing">Unit Testing</a></li>
<li><a href="#backwards-breaking-change---v2x-to-v3x">Backwards Breaking Change - v2.x to v3.x</a><ul>
<li>Important info on what the backwards breaking change was.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="install">Install</h1>
<pre><code class="language-bash"># via pip
pip install glazy

# via poetry
poetry add glazy
</code></pre>
<h2 id="how-to-use_1">How To Use</h2>
<p>The main class used most of the time is <code><a title="glazy.resource.Resource" href="resource.html#glazy.resource.Resource">Resource</a></code>.
Read the below/this-document first, but after your done here and need more details see
<code><a title="glazy.resource.Resource" href="resource.html#glazy.resource.Resource">Resource</a></code>, you can look at the doc-comment for that module and class for
more detailed
reference-type documentation.</p>
<p>Below is a high-level-overview of how to use this library</p>
<h3 id="what-its-used-for">What It's Used For</h3>
<p>If you need a lazily created singleton-type object
(but can still temporary override in a decoupled fashion if needed)
then this library could come in use for your situation.</p>
<h4 id="example-use-cases">Example Use Cases</h4>
<ul>
<li>Network connection and/or a remote resource/client.</li>
<li>You can wrap these objects in a <code><a title="glazy.resource" href="resource.html">glazy.resource</a></code>, the resource provides the object.</li>
<li>Objects to wrap are 'client' like things, and allow you to communicate with some external system.</li>
<li>Very common for these objects to represent an already-open network connection,
So there are performance considerations to try and keep connection open and to reuse it.</li>
<li>See <code>xyn_aws</code> for a special Resource subclass that wraps boto clients/resources,
allows you to lazily get a shared aws client/resource.<ul>
<li>It also uses a more advance feature, ActiveResourceProxy, to represent boto resources/clients
that are importable into other modules and directly usable.</li>
</ul>
</li>
<li>Common configuration or setting values</li>
<li>See also:<ul>
<li>xyn_settings</li>
<li>A Resource subclass that has extra features geared towards this use case.</li>
<li>xyn_config</li>
<li>Way to get settings from SSM, Secrets Manager and other remote locations.</li>
</ul>
</li>
<li>Anything that needs to be lazily allocated,
especially if they need to be re-created for each unit-test run.</li>
<li>Example: things with moto, requests-mock<ul>
<li>This use useful when session/clients needs to be created after a mock installed.
So if code-base uses Resource
to grab a requests session (for example),
when a new unit-test runs it will allocate a new requests session, and mock will therefore work.
While at the same time the code in prod/deployed code it will just use a shared session
that sticks around
between lambda runs, etc. (which is what you want to happen in deployed code).</li>
</ul>
</li>
<li>Basic dependency injection scenarios, where two separate pieces of code need to use a shared
object of some sort that you want to 'inject' into them.</li>
<li>Does it in a way that prevents you having to pass around the object manually everywhere.</li>
<li>Promotes code-decoupling, since there is less-temptation to couple them if it's easy to share
what they need between each-other, without having each piece of code having to know about each-other.</li>
</ul>
<h3 id="overview">Overview</h3>
<p>The main class used most of the time is <code><a title="glazy.resource.Resource" href="resource.html#glazy.resource.Resource">Resource</a></code>,
you can look at the doc-comment for that module and class for more details.</p>
<p>Allows you to create sub-classes that act as sharable singleton-type objects that
we are calling resources here.
These are also typically objects that should generally stick around and should be created lazily.</p>
<p>Also allows code to temporarily create, customize and activate a resource if you don't want
the customization to stick around permanently.
You can do it without your or other code needing to be aware of each other.</p>
<p>This helps promote code decoupling, since it's so easy to make a Resource activate it
as the 'current' version to use.</p>
<p>The only coupling that takes place is to the Resource sub-class it's self.</p>
<p>Each separate piece of code can be completely unaware of each other,
and yet each one can take advantage of the shared resource.</p>
<p>This means that Resource can also help with simple dependency injection use-case scenarios.</p>
<h3 id="quick-start-example-code">Quick Start Example Code</h3>
<pre><code class="language-python">from glazy import Resource

# This is a example Resource class, the intent with this class is to treat 
# it as a semi-singleton shared resource.
class MyResource(Resource):

    # It's important to allow resources to be allocated with
    # no required init arguments.
    # That way a default-instance/version of the class can
    # easily be created lazily.
    def __init__(self, name = None):
        if name is not None:
            self.name = name
    name: str = 'my-default-value'

# Gets currently active instance of &lt;code&gt;MyResource&lt;/code&gt;, or lazily creates if needed.
# If system creates a new instance of MyResource, it will save it and reuse it
# in the future when it's asked for.
#
# Next, we get value of &lt;code&gt;some\_attribute&lt;/code&gt; off of it.
# Prints 'my-default-value'
print(MyResource.resource().name)

# Change the value of the name attribute on current resource
MyResource.resource().name = 'changing-the-value'

# Now prints 'changing-the-value'
print(MyResource.resource().name)

# You can temporarily override a resource via a python context manager:
with MyResource(name='my-temporary-name'):
    # When someone askes for the current resource of &lt;code&gt;MyResource&lt;/code&gt;,
    # they will get back the one I created in &lt;code&gt;with&lt;/code&gt; statement above.
    #
    # Now prints 'my-temporary-name'
    print(MyResource.resource().name)

# Object we created and temporary activated by above &lt;code&gt;with&lt;/code&gt; statement
# has been deactivated (ie: thrown out).
# Old one that was the active one previously is the one that is now used when
# the current resource for &lt;code&gt;MyResource&lt;/code&gt; is asked for.
#
# prints 'changing-the-value'
print(MyResource.resource().name)
</code></pre>
<h2 id="advanced-use-cases">Advanced Use Cases</h2>
<h3 id="resource-dataclasses">Resource + Dataclasses</h3>
<p>You can use the built-in dataclasses with Resource without a problem.
Just ensure all fields are optional (ie: they all have default values).</p>
<p>Example:</p>
<pre><code class="language-python">from glazy import Resource
from dataclasses import  dataclass

@dataclass
class DataResource(Resource):
    # Making all fields optional, so DataResource can be created lazily:
    my_optional_field: str = None
    another_optional_field: str = &quot;hello!&quot;

# Get current DataResource resource, print it's another_optional_field;
# will print out `hello!`:
print(DataResource.resource().another_optional_field)
</code></pre>
<h3 id="thread-safety">Thread Safety</h3>
<p>There is a concept of an app-root, and thread-root contexts.</p>
<p>By default, each Resource subclass will be shared between different threads,
ie: it's assumed to be thread-safe.</p>
<p>You can indicate a Resource subclass should not be shared between threads
by inheriting from <code>glazy.resource.ThreadUnsafeResource</code> instead,
or by setting the <strong>class attribute</strong> (on your custom sub-class of Resource)
<code>glazy.resource.Resource.resource_thread_sharable</code> to <code>False</code>.</p>
<p>Things that are probably not thread-safe in general
are resources that contain network/remote type connections/sessions/clients.</p>
<p>Concrete Examples In Code Base:</p>
<ul>
<li>Requests library session</li>
<li>xyn_model_rest uses a Resource to wrap requests library session, so it can automatically
reuse connections on same thread, but use new session if on different thread.
Also helps with unit testing, when Mocking requests URL calls.</li>
<li>boto client/resource</li>
<li>Library says it's not thread-safe, you need to use a diffrent object per-thread.</li>
<li>Moto mocking library for AWS services needs you to allocate a client after it's setup,
(so lazily allocate client/resource from boto).</li>
<li>Use <code>xyn_aws</code> for easy to use Resource's that wrap boto client/resources that
accomplish being both lazy and will allocate a new one per-thread for you automatically.</li>
</ul>
<h3 id="active-resource-proxy">Active Resource Proxy</h3>
<p>You can use the convenience method <code><a title="glazy.resource.Resource.resource_proxy" href="resource.html#glazy.resource.Resource.resource_proxy">Resource.resource_proxy()</a></code> to easily get a
proxy object.</p>
<p>Or you can use <code><a title="glazy.proxy.ActiveResourceProxy.wrap" href="proxy.html#glazy.proxy.ActiveResourceProxy.wrap">ActiveResourceProxy.wrap()</a></code> to create an object that will act
like the current resource.
All non-dunder attributes/methods will be grabbed/set on the current object instead of the proxy.</p>
<p>This means you can call all non-special methods and access normal attributes,
as if the object was really the currently active resource instance.</p>
<p>Any methods/attributes that start with a <code>_</code> will not be used on the proxied object,
but will be used on only the proxy-object it's self.
This means, you should not ask/set any attributes that start with <code>_</code> (underscore)
when using the proxy object.</p>
<p>A real-world example is <code>xyn_config.config.config</code>, it uses this code for that object:</p>
<pre><code class="language-python">from glazy import ActiveResourceProxy
from xyn_config import Config

# The &lt;code&gt;xny\_resource.proxy.ActiveResourceProxy.wrap&lt;/code&gt; method to get a correctly type-hinted (for IDE)
# proxy back:
config = ActiveResourceProxy.wrap(Config)

# This is a simpler way to get the same proxy
# (no imports are needed, just call the class method on any resource class):
config = Config.resource_proxy()
</code></pre>
<p>Now someone can import and use it as-if it's the current config object:</p>
<pre><code class="language-python">from xyn_config import config

value = config.get('some_config_var')
</code></pre>
<p>When you ask <code>config</code> for it's <code>get</code> attribute, it will get it from the current
active resource for <code>Config</code>. So it's the equivalent of doing this:</p>
<pre><code class="language-python">from xyn_config import Config

get_method = Config.resource().get
value = get_method('some_config_var')
</code></pre>
<p>The code then executes the method that was attached to the <code>get</code> attribute.
This makes the call-stack clean, if an error happens it won't be going through
the ActiveResourceProxy.
The <code><a title="glazy.proxy.ActiveResourceProxy" href="proxy.html#glazy.proxy.ActiveResourceProxy">ActiveResourceProxy</a></code> already return the <code>get</code> method
and is finished.
The outer-code is the one that executed/called the method.</p>
<p>Another read-world example is in the <code>xyn_aws</code>.</p>
<p>See <code><a title="glazy.proxy.ActiveResourceProxy" href="proxy.html#glazy.proxy.ActiveResourceProxy">ActiveResourceProxy</a></code> for more ref-doc type details.</p>
<h2 id="unit-testing">Unit Testing</h2>
<p>The <code>glazys.pytest_plugin.xyn_context</code> fixture in particular will be automatically used
for every unit test. This is important, it ensures a blank root-context is used each time
a unit test executes.</p>
<p>This is accomplished via an <code>autouse=True</code> fixture.
The fixture is in a pytest plugin module.
This plugin module is automatically found and loaded by pytest.
pytest checks all installed dependencies in the environment it runs in,
so as long as glazy is installed in the environment as a dependency it will find this
and autoload this fixture for each unit test.</p>
<p>This means for each unit test executed via pytest, it will always start with no resources
from a previous unit-test execution.</p>
<p>Each unit-test will therefore always start out in the same state,
and a unit-test won't leak/let-slip any of the changes it makes to its
Resources into another unit-test.</p>
<p>This use useful when session/clients needs to be created after a mock installed.
So if code-base uses Resource
to grab a requests session (for example),
when a new unit-test runs it will allocate a new requests session, and mock will therefore work.
While at the same time the code in prod/deployed code it will just use a shared session
that sticks around
between lambda runs, etc. (which is what you want to happen in deployed code).</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Used to lazily created shared singleton-like objects in a decoupled way.

# How To Use

..include:: ../README.md
&#34;&#34;&#34;

from .context import Context
from .resource import Resource, PerThreadResource
from .proxy import ActiveResourceProxy</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="glazy.context" href="context.html">glazy.context</a></code></dt>
<dd>
<div class="desc"><p>Manage shared resource and dependency injection …</p></div>
</dd>
<dt><code class="name"><a title="glazy.errors" href="errors.html">glazy.errors</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="glazy.proxy" href="proxy.html">glazy.proxy</a></code></dt>
<dd>
<div class="desc"><p>Used to have a normal looking object that can be imported directly into other modules and used …</p></div>
</dd>
<dt><code class="name"><a title="glazy.pytest_plugin" href="pytest_plugin.html">glazy.pytest_plugin</a></code></dt>
<dd>
<div class="desc"><p>Auto-loaded common fixtures for helping with unit-testing …</p></div>
</dd>
<dt><code class="name"><a title="glazy.resource" href="resource.html">glazy.resource</a></code></dt>
<dd>
<div class="desc"><p>Easily create singleton-like classes in a sharable/injectable/decoupled way …</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#how-to-use">How To Use</a></li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="glazy.context" href="context.html">glazy.context</a></code></li>
<li><code><a title="glazy.errors" href="errors.html">glazy.errors</a></code></li>
<li><code><a title="glazy.proxy" href="proxy.html">glazy.proxy</a></code></li>
<li><code><a title="glazy.pytest_plugin" href="pytest_plugin.html">glazy.pytest_plugin</a></code></li>
<li><code><a title="glazy.resource" href="resource.html">glazy.resource</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>