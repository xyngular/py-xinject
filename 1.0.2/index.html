
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Getting Started - Docs for xinject</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#install" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Docs for xinject" class="md-header__button md-logo" aria-label="Docs for xinject" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docs for xinject
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Docs for xinject" class="md-nav__button md-logo" aria-label="Docs for xinject" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Docs for xinject
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index md-nav__link--active">
          <a href=".">Getting Started</a>
          
            <label for="__nav_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="unit-testing/" class="md-nav__link">
        Unit Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dataclasses/" class="md-nav__link">
        Data Classes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="thread-safety/" class="md-nav__link">
        Thread Safety
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dependency-proxy/" class="md-nav__link">
        Dependency Proxy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="api/xinject/" target="_blank" class="md-nav__link">
        API Reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    Install
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    Quick Start
  </a>
  
    <nav class="md-nav" aria-label="Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lazy-s3-resource-dependency-example" class="md-nav__link">
    Lazy S3 Resource Dependency Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-temporarily" class="md-nav__link">
    Inject Temporarily
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-permanently" class="md-nav__link">
    Inject Permanently
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generalizedgeneric-example" class="md-nav__link">
    Generalized/Generic Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-its-used-for" class="md-nav__link">
    What It's Used For
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-use-cases" class="md-nav__link">
    Example Use Cases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Getting Started</h1>

<h2 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># via pip</span>
pip install xinject

<span class="c1"># via poetry</span>
poetry add xinject
</code></pre></div></td></tr></table></div>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Main focus is an easy way to create lazy universally injectable dependencies;
in less magical way. It also leans more on the side of making it easier to get
the dependency you need anywhere in the codebase.</p>
<p>py-xinject allows you to easily inject lazily created universal dependencies into whatever code that needs them,
in an easy to understand and self-documenting way.</p>
<details class="note">
<summary>xinject is short for "Universal Dependency"</summary>
<p>ie: a lazy universally injectable dependency</p>
</details>
<details class="note" open="open">
<summary>Note</summary>
<p>Read this document first to get a general overview before reading the API reference
documentation.</p>
<p>When you're done here and want more details go to <a href="api/xinject">API Reference</a>
or directly to <a href="api/xinject/dependency.html#xinject.dependency.Dependency" target="_blank"><code>Dependency API Refrence</code></a>
for more detailed reference-type documentation.</p>
</details>
<h2 id="quick-start">Quick Start<a class="headerlink" href="#quick-start" title="Permanent link">&para;</a></h2>
<p>Although it's not required, most of the time you'll want to subclass <a href="api/xinject/dependency.html#xinject.dependency.Dependency" target="_blank"><code>Dependency</code></a>.
The subclass will inherit some nice features that make it easier to use.</p>
<p>The following is a specific usecase followed by a more generalized example</p>
<h3 id="lazy-s3-resource-dependency-example">Lazy S3 Resource Dependency Example<a class="headerlink" href="#lazy-s3-resource-dependency-example" title="Permanent link">&para;</a></h3>
<p>Here is a very basic injectable/sharable lazily created S3 resource.</p>
<p>We have a choice to inherit from ether Dependency, or DependencyPerThread.</p>
<p>The normal <code>Dependency</code> class lets the dependency be shared between threads, so more of a true singleton type
of object where under normal/default circomstances there would ever only be one instance of a partculare <code>Dependency</code>.</p>
<p>Using <a href="api/xinject/dependency.html#xinject.dependency.DependencyPerThread" target="_blank"><code>DependencyPerThread</code></a> will automatically get a
separate dependency object per-thread (ie: separate instance per-thread).
It simply inherits from Dependency and configures it to not be thread sharable.</p>
<p>In the example below, we do that with the Boto resource, as the boto documentation for resources states they
are not thread-safe. That means our program will need a separate s3 resource per-thread.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># This is the &quot;my_resources.py&quot; file/module.</span>

<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">xinject</span> <span class="kn">import</span> <span class="n">DependencyPerThread</span>


<span class="k">class</span> <span class="nc">S3</span><span class="p">(</span><span class="n">DependencyPerThread</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Keeping this simple; a more complex version</span>
        <span class="c1"># may store the `kwargs` and lazily create the s3 resource</span>
        <span class="c1"># only when it&#39;s asked for (via a `@property or some such).</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>To use this resource in any codebase, you can do this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># This is the &quot;my_functions.py&quot; file/module</span>

<span class="kn">from</span> <span class="nn">.my_resources</span> <span class="kn">import</span> <span class="n">S3</span>

<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">):</span>
    <span class="n">s3_resource</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span><span class="o">.</span><span class="n">resource</span>
    <span class="n">s3_resource</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="s1">&#39;my-bucket&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">dest_path</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>When <code>grab_file</code> is called it will grab the current <code>S3</code> dependency
and get the resource off of it.
If <code>S3</code> dependency has not been created yet, it will do so on the fly
and store and return the lazily created dependency in the future when
asked for it.</p>
<p>This means, the resource is only created when it needs to be.</p>
<h3 id="inject-temporarily">Inject Temporarily<a class="headerlink" href="#inject-temporarily" title="Permanent link">&para;</a></h3>
<p>Now, let's say you wanted to change/inject a different version of the
S3 dependency, you could do this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">.my_resources</span> <span class="kn">import</span> <span class="n">S3</span>
<span class="kn">from</span> <span class="nn">.my_functions</span> <span class="kn">import</span> <span class="n">download_file</span>

<span class="n">us_west_s3_resource</span> <span class="o">=</span> <span class="n">S3</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-west-2&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_s3_file_from_us_west</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">):</span>
    <span class="c1"># Can use Dependencies as a context-manager,</span>
    <span class="c1"># inject `use_west_s3_resource` inside `with`:</span>
    <span class="k">with</span> <span class="n">us_west_s3_resource</span><span class="p">:</span>
        <span class="n">download_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>

<span class="c1"># Can also use Dependencies as a function decorator,</span>
<span class="c1"># inject `use_west_s3_resource` whenever this method is called.</span>
<span class="nd">@us_west_s3_resource</span>
<span class="k">def</span> <span class="nf">get_s3_file_from_us_west</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">):</span>
    <span class="n">download_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>All classes that inherit from <code>Dependency</code> are context managers,
and so the <code>with</code> statement will 'activate' that dependency as the
current version to use.</p>
<p>That will inject an S3 resource configured with <code>region_name='us-west-2</code>
into the function you are calling.</p>
<p>It does not matter how many other methods needs to be called to get
to the method that needs the <code>S3</code> resource, it would still be injected
and used.</p>
<p>After the <code>with</code> statement is exited, the previous <code>S3</code> instance
(if any) that was active before the <code>with</code> statement is now what is used
from that point forward.</p>
<p>This allows you to decouple the code. Code that needs a resource can
grab it from the S3 class, and code that needs to configure
the resource can do so without having to know exactly what other methods
needs that dependency. It can configure the dependencies as/if needed,
start the app/process and be done.</p>
<p>The resource also sticks around inside the dependency, and can be reused/shared.
This allows the boto3 s3 resource (in the example above) to reuse already opened
TCP connections to s3 as the s3 resource is used from various parts of the
code base.</p>
<h3 id="inject-permanently">Inject Permanently<a class="headerlink" href="#inject-permanently" title="Permanent link">&para;</a></h3>
<p>If instead (see previous example) you don't want to temporarily inject
a dependency, but instead permanently do it you can do so in a few ways:</p>
<ul>
<li>Change the current dependency by setting attributes or calling methods on it.</li>
<li>Replace the current dependency with a different object.</li>
</ul>
<p>The first way is easy, you just access the current version of the resource.
I'll be using the <code>S3</code> dependency from the previous example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">.my_resources</span> <span class="kn">import</span> <span class="n">S3</span>
<span class="n">S3</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-west-2&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In this case, I am replacing the <code>resource</code> attribute on the S3 current
dependency instance/object with my own version of the resource.
From this point forward, it will be what is used
(unless some other code after this point temporarily injects their own
resource via a <code>with</code>; see previous example).</p>
<p>Fro the second way, you can access the repository of dependencies 
and swap/inject a different resource there.</p>
<p>This will add the dependency to the current context, and when that 
dependency is next asked for it will return the one that was added
here:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">xinject</span> <span class="kn">import</span> <span class="n">XContext</span>
<span class="kn">from</span> <span class="nn">.my_resources</span> <span class="kn">import</span> <span class="n">S3</span>

<span class="n">us_west_s3_resource</span> <span class="o">=</span> <span class="n">S3</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-west-2&#39;</span><span class="p">)</span>
<span class="n">XContext</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">us_west_s3_resource</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>And finally, you can replace dependencies with a completely different
class of object. This is sometimes useful when doing unit-testing.</p>
<p>What we do here is add out special MyS3MockingClass object
and tell context to use this in place for the <code>S3</code> type dependency.</p>
<p>In the future, this mocking object will be returned when the code
asks for the <code>S3</code> dependency-type.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">xinject</span> <span class="kn">import</span> <span class="n">XContext</span>
<span class="kn">from</span> <span class="nn">.my_resources</span> <span class="kn">import</span> <span class="n">S3</span>
<span class="kn">from</span> <span class="nn">.my_mocks</span> <span class="kn">import</span> <span class="n">MyS3MockingClass</span>

<span class="n">s3_mocking_obj</span> <span class="o">=</span> <span class="n">MyS3MockingClass</span><span class="p">()</span>
<span class="n">XContext</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s3_mocking_obj</span><span class="p">,</span> <span class="n">for_type</span><span class="o">=</span><span class="n">S3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="generalizedgeneric-example">Generalized/Generic Example<a class="headerlink" href="#generalizedgeneric-example" title="Permanent link">&para;</a></h3>
<p>Although it's not required, most of the time you'll want to subclass <a href="api/xinject/dependency.html#xinject.dependency.Dependency" target="_blank"><code>Dependency</code></a>.
The subclass will inherit some nice features that make it easier to use.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">xinject</span> <span class="kn">import</span> <span class="n">Dependency</span>

<span class="c1"># This is an example Dependency class, the intent with this class</span>
<span class="c1"># is to treat it as a semi-singleton shared dependency.</span>
<span class="k">class</span> <span class="nc">MyUniversalDependency</span><span class="p">(</span><span class="n">Dependency</span><span class="p">):</span>

  <span class="c1"># It&#39;s important to allow dependencies to be allocated with</span>
  <span class="c1"># no required init arguments.</span>
  <span class="c1"># That way a default-instance/version of the class can</span>
  <span class="c1"># easily be created lazily.</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;original-value&#39;</span>


<span class="c1"># Gets currently active instance of `MyUniversalDependency`,</span>
<span class="c1"># or lazily creates if needed. If system creates a new</span>
<span class="c1"># instance of MyUniversalDependency, it will save it and</span>
<span class="c1"># reuse it in the future when it&#39;s asked for.</span>
<span class="c1">#</span>
<span class="c1"># Next, we get value of it&#39;s `name` attribute:</span>

<span class="k">assert</span> <span class="n">MyUniversalDependency</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;original-value&#39;</span>

<span class="c1"># Change the value of the name attribute on current dependency</span>
<span class="n">MyUniversalDependency</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;changed-value&#39;</span>

<span class="c1"># We still have access to the same object, so it has the new value:</span>
<span class="k">assert</span> <span class="n">MyUniversalDependency</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;changed-value&#39;</span>

<span class="c1"># Inherit from Dependency allows you to use them as a context manager.</span>
<span class="c1"># This allows you to easily/temporarily inject dependencies:</span>

<span class="k">with</span> <span class="n">MyUniversalDependency</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;injected-value&#39;</span><span class="p">):</span>
  <span class="c1"># When someone asks for the current dependency of `MyResource`,</span>
  <span class="c1"># they will get the one I created in `with` statement above.</span>

  <span class="k">assert</span> <span class="n">MyUniversalDependency</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;injected-value&#39;</span>

<span class="c1"># Object we created and temporary activated/injected</span>
<span class="c1"># by above `with` statement has been deactivated/uninjected.</span>
<span class="c1"># So, the previous object is what is now used:</span>

<span class="k">assert</span> <span class="n">MyUniversalDependency</span><span class="o">.</span><span class="n">grab</span><span class="p">()</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;changed-value&#39;</span>
</code></pre></div></td></tr></table></div>
<p>There is also a way to get a proxy-object that represents the
currently used object.</p>
<p>This allows you to have an object that is directly importable/usable
and still have it be injectable.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">xinject</span> <span class="kn">import</span> <span class="n">Dependency</span>


<span class="k">class</span> <span class="nc">MyUniversalDependency</span><span class="p">(</span><span class="n">Dependency</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;default-value&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>


<span class="n">my_universal_dependency</span> <span class="o">=</span> <span class="n">MyUniversalDependency</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">my_universal_dependency</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;changing-the-value&#39;</span>

<span class="k">with</span> <span class="n">MyUniversalDependency</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;injected-value&#39;</span><span class="p">):</span>
    <span class="c1"># The proxy object proxies to the currently activated/injected</span>
    <span class="c1"># version of the dependency:</span>
    <span class="k">assert</span> <span class="n">my_universal_dependency</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;injected-value&#39;</span>
</code></pre></div></td></tr></table></div>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The main class used most of the time is <a href="api/xinject/dependency.html#xinject.dependency.Dependency" target="_blank"><code>Dependency</code></a>.</p>
<p>Allows you to create sub-classes that act as sharable singleton-type objects that
we are calling resources here.
These are also typically objects that should generally stick around and should be created lazily.</p>
<p>Also allows code to temporarily create, customize and activate a dependency if you don't want
the customization to stick around permanently.
You can do it without your or other code needing to be aware of each other.</p>
<p>This helps promote code decoupling, since it's so easy to make a Dependency activate it
as the 'current' version to use.</p>
<p>The only coupling that takes place is to the Dependency sub-class it's self.</p>
<p>Each separate piece of code can be completely unaware of each other,
and yet each one can take advantage of the shared dependency.</p>
<p>This means that Dependency can also help with simple dependency injection use-case scenarios.</p>
<h3 id="what-its-used-for">What It's Used For<a class="headerlink" href="#what-its-used-for" title="Permanent link">&para;</a></h3>
<ul>
<li>Lazily created singleton-type objects that you can still override/inject as needed in a decoupled fashion.</li>
<li>Supports foster decoupled code by making it easy to use dependency injection code patterns.<ul>
<li>Lazily created resources, like api clients.</li>
<li>Helps with unit testing mock frameworks.<ul>
<li>Example: moto needs boto clients to be created after unit test starts, so it can intercept and mock it.</li>
<li>Using a dependency to get boto client allows them to be lazily created/mocked during each unit-test run.</li>
</ul>
</li>
</ul>
</li>
<li>Lazily create sharable objects on demand when/where needed.<ul>
<li>Things that need to be shared in many locations, without having to pass them everywhere, or couple the code together.</li>
<li>Example: session from requests library, so code can re-use already open TCP connections to an API.</li>
</ul>
</li>
</ul>
<h3 id="example-use-cases">Example Use Cases<a class="headerlink" href="#example-use-cases" title="Permanent link">&para;</a></h3>
<ul>
<li>Network connection and/or a remote dependency/client.<ul>
<li>You can wrap these objects in a <code>dependency</code>, the dependency provides the object.</li>
<li>Objects to wrap are 'client' like things, and allow you to communicate with some external system.</li>
<li>Very common for these objects to represent an already-open network connection,
  So there are performance considerations to try and keep connection open and to reuse it.</li>
</ul>
</li>
<li>Common configuration or setting objects.</li>
<li>Anything that needs to be lazily allocated,
  especially if they need to be re-created for each unit-test run.<ul>
<li>Since all dependencies are thrown-away before running each unit-test function,
  all dependencies will be lazily re-created each time by default.</li>
<li>Examples:<ul>
<li>moto<ul>
<li>You need to create boto clients after moto is setup in order for moto to intercept/mock
  the service the boto client uses.</li>
<li>But you also don't want the main code base to create a brand new boto client each time it needs it,
  so that it can reuse/share already established TCP connections.</li>
<li>Using a Dependency to lazily manage your boto clients solves both of these issues.</li>
</ul>
</li>
<li>requests-mock<ul>
<li>Requests-mock needs to be in place before the code base creates a requests-session<ul>
<li>You want to use a session in main code base to reuse/share already established TCP connections
  to your http apis.</li>
</ul>
</li>
<li>Using a Dependency to manage a shared requests session lets you both lazily create the session to help
  with unit testing, but also allows you to easily reuse the session in your codebase in a decoupled manner.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Basic dependency injection scenarios, where two separate pieces of code need to use a shared
  object of some sort that you want to 'inject' into them.<ul>
<li>Does it in a way that prevents you having to pass around the object manually everywhere.</li>
<li>Promotes code-decoupling, since there is less-temptation to couple them if it's easy to share
  what they need between each-other, without having each piece of code having to know about each-other.</li>
</ul>
</li>
</ul>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2022-12-01
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
      
        
        <a href="unit-testing/" class="md-footer__link md-footer__link--next" aria-label="Next: Unit Testing" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Unit Testing
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.sections", "navigation.expand", "navigation.top", "navigation.indexes", "navigation.tracking", "content.code.annotate"], "search": "assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>